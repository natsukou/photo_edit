<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AIæ¥å£æµ‹è¯•</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 30px 20px;
      background: #f5f5f5;
    }
    h1 {
      color: #333;
      margin-bottom: 30px;
      text-align: center;
    }
    .test-section {
      background: white;
      padding: 25px;
      margin-bottom: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h3 {
      color: #666;
      margin-bottom: 15px;
      border-bottom: 2px solid #4CAF50;
      padding-bottom: 8px;
    }
    button {
      background: #4CAF50;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      margin: 10px 5px 10px 0;
      transition: background 0.3s;
    }
    button:hover {
      background: #45a049;
    }
    button:active {
      transform: scale(0.98);
    }
    #result {
      margin-top: 20px;
      padding: 20px;
      background: #fafafa;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      white-space: pre-wrap;
      max-height: 500px;
      overflow-y: auto;
      font-family: 'Courier New', monospace;
      font-size: 13px;
      line-height: 1.6;
    }
    .error {
      background: #ffebee;
      border-color: #ef5350;
      color: #c62828;
    }
    .success {
      background: #e8f5e9;
      border-color: #66bb6a;
      color: #2e7d32;
    }
    input[type="file"] {
      margin: 15px 0;
      padding: 10px;
      border: 2px dashed #ddd;
      border-radius: 6px;
      width: 100%;
      cursor: pointer;
    }
    input[type="file"]:hover {
      border-color: #4CAF50;
    }
    img {
      max-width: 100%;
      max-height: 300px;
      margin: 15px 0;
      border-radius: 6px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    .status-indicator {
      display: inline-block;
      width: 10px;
      height: 10px;
      border-radius: 50%;
      margin-right: 8px;
    }
    .status-ok { background: #4CAF50; }
    .status-error { background: #f44336; }
    .loading {
      display: none;
      margin-top: 10px;
      color: #666;
    }
    .loading.active {
      display: block;
    }
  </style>
</head>
<body>
  <h1>ğŸ¤– AIæ¥å£æµ‹è¯•å·¥å…·</h1>
  
  <div class="test-section">
    <h3>ğŸ“¡ 1. æµ‹è¯•AIæœåŠ¡çŠ¶æ€</h3>
    <button onclick="testStatus()">ğŸ” æµ‹è¯• /api/ai/status</button>
    <div class="loading" id="loading1">åŠ è½½ä¸­...</div>
  </div>
  
  <div class="test-section">
    <h3>ğŸ“· 2. æµ‹è¯•å›¾ç‰‡è¯†åˆ«</h3>
    <input type="file" id="imageInput" accept="image/*">
    <img id="preview" style="display:none;">
    <br>
    <button onclick="testRecognize()">ğŸ¯ æµ‹è¯• /api/ai/recognize</button>
    <div class="loading" id="loading2">è¯†åˆ«ä¸­...</div>
  </div>
  
  <div id="result"></div>

  <script>
    const API_BASE = 'http://localhost:3000/api';
    
    console.log('ğŸš€ æµ‹è¯•é¡µé¢å·²åŠ è½½');
    console.log('APIåŸºç¡€åœ°å€:', API_BASE);
    
    // æ˜¾ç¤ºå›¾ç‰‡é¢„è§ˆ
    document.getElementById('imageInput').addEventListener('change', function(e) {
      console.log('ğŸ“ å›¾ç‰‡é€‰æ‹©äº‹ä»¶è§¦å‘');
      const file = e.target.files[0];
      if (file) {
        console.log('å›¾ç‰‡æ–‡ä»¶:', file.name, file.size, 'bytes');
        const reader = new FileReader();
        reader.onload = function(event) {
          const img = document.getElementById('preview');
          img.src = event.target.result;
          img.style.display = 'block';
          console.log('âœ… å›¾ç‰‡é¢„è§ˆå·²åŠ è½½');
        };
        reader.readAsDataURL(file);
      }
    });
    
    function showResult(text, isError = false) {
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = text;
      resultDiv.className = isError ? 'error' : 'success';
      resultDiv.style.display = 'block';
    }
    
    function showLoading(id, show) {
      const loading = document.getElementById(id);
      if (show) {
        loading.classList.add('active');
      } else {
        loading.classList.remove('active');
      }
    }
    
    async function testStatus() {
      console.log('ğŸ” å¼€å§‹æµ‹è¯• AI çŠ¶æ€...');
      
      const resultDiv = document.getElementById('result');
      resultDiv.textContent = 'æ­£åœ¨æµ‹è¯• AI çŠ¶æ€...';
      resultDiv.className = '';
      showLoading('loading1', true);
      
      try {
        const url = `${API_BASE}/ai/status`;
        console.log('è¯·æ±‚URL:', url);
        
        const response = await fetch(url);
        console.log('å“åº”çŠ¶æ€:', response.status);
        
        const data = await response.json();
        console.log('å“åº”æ•°æ®:', data);
        
        showResult(JSON.stringify(data, null, 2), !response.ok);
      } catch (error) {
        console.error('â— é”™è¯¯:', error);
        showResult('é”™è¯¯: ' + error.message, true);
      } finally {
        showLoading('loading1', false);
      }
    }
    
    async function testRecognize() {
      console.log('ğŸ¯ å¼€å§‹æµ‹è¯•å›¾ç‰‡è¯†åˆ«...');
      
      const resultDiv = document.getElementById('result');
      const fileInput = document.getElementById('imageInput');
      
      if (!fileInput.files[0]) {
        alert('è¯·å…ˆé€‰æ‹©å›¾ç‰‡');
        console.warn('âš ï¸ æœªé€‰æ‹©å›¾ç‰‡');
        return;
      }
      
      resultDiv.textContent = 'æ­£åœ¨è¯†åˆ«å›¾ç‰‡...';
      resultDiv.className = '';
      showLoading('loading2', true);
      
      // è¯»å–å›¾ç‰‡ä¸ºBase64
      const reader = new FileReader();
      reader.onload = async function(event) {
        const imageData = event.target.result;
        
        console.log('ğŸ“Š å›¾ç‰‡æ•°æ®é•¿åº¦:', imageData.length);
        console.log('ğŸ“Š å›¾ç‰‡æ•°æ®å‰100å­—ç¬¦:', imageData.substring(0, 100));
        
        try {
          const url = `${API_BASE}/ai/recognize`;
          console.log('è¯·æ±‚URL:', url);
          
          const response = await fetch(url, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              image: imageData
            })
          });
          
          console.log('å“åº”çŠ¶æ€:', response.status);
          console.log('å“åº”å¤´:', [...response.headers.entries()]);
          
          const data = await response.json();
          console.log('å“åº”æ•°æ®:', data);
          
          showResult(JSON.stringify(data, null, 2), !response.ok);
        } catch (error) {
          console.error('â— è¯·æ±‚é”™è¯¯:', error);
          showResult('é”™è¯¯: ' + error.message + '\n\n' + error.stack, true);
        } finally {
          showLoading('loading2', false);
        }
      };
      
      reader.readAsDataURL(fileInput.files[0]);
    }
    
    // é¡µé¢åŠ è½½åè‡ªåŠ¨æµ‹è¯•è¿æ¥
    window.addEventListener('load', function() {
      console.log('âœ… é¡µé¢å·²å®Œå…¨åŠ è½½');
      console.log('ğŸ“ æµ‹è¯•å‡½æ•°å·²æ³¨å†Œ:', typeof testStatus, typeof testRecognize);
    });
  </script>
</body>
</html>
